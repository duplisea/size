---
title: "README"
author: "Daniel E. Duplisea"
date: ""
output: md_document
---
[![experimental](http://badges.github.io/stability-badges/dist/experimental.svg)](http://github.com/badges/stability-badges)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Install and load package

```{r installsize, eval=FALSE, message=FALSE}
library(devtools)
install_github("duplisea/size")
```

Load the package
```{r loadccca, message=FALSE}
library(size)
```

## Plot the survey locations on a map of the Gulf
```{r mapsurvey, message=FALSE}
map.f()
points(-decdeg.f(ngsl.set$lon_deb*100),decdeg.f(ngsl.set$lat_deb*100),pch=".",col="red")
```


## Size spectrum of the norther Gulf fish and invertebrate community

Numbers per haul in log2 weight categories

```{r BSS}
tmp= SS.f("all",codeqc=792)
tmp$labundance= log2(tmp$abundance)
tmp$lbiomass= log2(tmp$biomass)
tmp= tmp[tmp$lg2W>3 & tmp$lg2W<16,]

par(mfcol=c(6,5),mar=c(1,1,1,1),omi=c(.5,.5,.01,.01))
years= sort(unique(tmp$year))
for (y in years){
  tmp2= tmp[tmp$year==y,]
  plot(tmp2$lg2W,tmp2$labundance,type="p",,ylim=c(0,max(tmp$labundance)), xlab="", ylab="", pch=20)
  nss.quad= lm(labundance~ poly(lg2W,2),data=tmp2)
  lines(tmp2$lg2W,predict(nss.quad),lwd=2)
  legend("topleft",legend=y,cex=0.6,bty="n",text.col="blue")
}
mtext(side=1,text="Log2 Weight-class",outer=T,line=2)
mtext(side=2,text="Abundance (no per tow)",outer=T,line=2)
```

## The predation size spectrum

Given the predator size distribution in the system in a year, the average predator/prey weight ratio and the variance (cv) of this 
this, the exponent relating consumption rate to body weight for a predator, the predation size spectrum can be determined. This is like
a predation risk or the sizes of prey that would be most likely targetted by predators in the system in a year.

type ?PSS.f to see why I suppressed the warnings and I do not want them to appear in this markdown file.

```{r PSS, message=FALSE}
pss= suppressWarnings(PSS.f("all",PPWR=10))
pss.scaled= pss$pred.risk/max(pss$pred.risk)
plot(pss$year, pss.scaled[10,],type="l",lwd=2, xlab="Year",ylab="Predation risk for 10 cm prey")

# add a line assuming a predator/prey weight ratio of 20 instead of 10
pss= suppressWarnings(PSS.f("all",PPWR=20))
pss.scaled= pss$pred.risk/max(pss$pred.risk)
lines(pss$year, pss.scaled[10,],lwd=2,col="blue")

legend("topleft",bty="n",lwd=2,col=c("black","blue"),lty=1,legend=c("PPWR=10","PPWR=20"),cex=0.9)
```

What you see is essentially the impact of the huge redfish year-class from 2011 becoming predators. if the PPWR is 10 then this year class starts having a large impacts on 10 cm prey by 2018 but if the PPWR is 20, prey of 10 cm are still mostly too large for this year class of redfish. The increase in predation risk will come further along.

## PLF analysis with the installed dataset

The PLF for all species with a 30 cm threshold between small and large individuals
```{r PLFbase}
PLF.all= PLF.f(species.group="all",cutoff=30)
```

The PLF for all species with a 30 cm threshold between small and large individuals
```{r PLFdem}
PLF.dem= PLF.f(species.group="demersal",cutoff=30)
```

The PLF for all species with a 30 cm threshold between small and large individuals
```{r PLFgf}
PLF.gf= PLF.f(species.group="groundfish",cutoff=30)
```

The PLF for all species with a 30 cm threshold between small and large individuals
```{r PLFredish}
PLF.rf= PLF.f(species.group="code",codeqc=792,cutoff=20)
```


Plot the various PLF community indicators
```{r PLFplots}
ymax=max(c(PLF.all$plf,PLF.dem$plf,PLF.gf$plf))
plot(PLF.all$year, PLF.all$plf,xlab="Year",ylab="Proportion of individuals >=30cm",type="l",lwd=2,
  ylim=c(0,ymax))
lines(PLF.dem$year,PLF.dem$plf,col="blue",lwd=2)
lines(PLF.gf$year,PLF.gf$plf,col="green",lwd=2)
legend("topright",lwd=2,col=c("black","blue","green"),legend=c("everything","demersal","groundfish"),bty="n",cex=0.6)
```

## References

Duplisea, D.E. 2005. Running the gauntlet: the predation environment of small fish in the northern Gulf of St Lawrence, Canada. ICES Journal of Marine Science 62: 412-416

Duplisea, D.E. and Castonguay, M. 2006. Comparison and utility of different size-based metrics of fish communities for detecting fishery impacts. Canadian Journal of Fisheries and Aquatic Sciences 63: 810-820.

Greenstreet, S.P., Rogers, S.I., Rice, J.C., Piet, G.J., Guirey, E.J., Fraser, H.M. and Fryer, R.J. 2010. Development of the EcoQO for the North Sea fish community. ICES Journal of Marine Science 68: 1-11.

[![experimental](http://badges.github.io/stability-badges/dist/experimental.svg)](http://github.com/badges/stability-badges)